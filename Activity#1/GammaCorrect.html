<!doctype html>
<html lang="en">

<head>
  <title>Computer Graphics Lab - Gamma Correction</title>
  <meta charset="utf-8" />
  <style>
    html {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      text-align: center;
      font-size: 150%;
    }

    #gray-reference {
      background: url("checker.png") repeat;
      margin: auto;
      width: 640px;
      height: 640px;
    }

    form {
      width: 720px;
      margin: auto;
    }

    input {
      width: 720px;
      margin: 1em 0;
    }
  </style>
</head>

<body>

  <p>Adjust the slider until the value/lightness of the background appears to match that of the square
    in the center. The number displayed beneath the slider is an estimate for your monitor's gamma.</p>

  <div id="gray-reference"></div>

  <form>
    <input type="range" min="0" max="255" step="1" value="128" onchange="render(this.value)" />
    <output id="gamma"></output>
  </form>

  <script>
    /* Helper function to convert a single grayscale number to a CSS color value */
    function valueToGray(v) {
      return "rgb(" + v + "," + v + "," + v + ")";
    }

    /* Recolors the background based on the slider value and computes the gamma parameter. */
    function render(inputIntensity) {
      /* Set page background color based on the slider value. */
      document.body.style.backgroundColor = valueToGray(inputIntensity);
      console.log("Input: " + inputIntensity);

      /* Compute and display the corresponding gamma parameter. */

      /* An intensity of 0 gives a gamma of NaN and an intensity of 1 gives a
        gamma of infinity. This should be okay becuase we don't need to gamma
        correct these values since they are already perfect :)
      */

      /*
        We need a way of mapping the values from 0-255 so we divide the input
        value by it's largest possible (255) to convert the value to a number
        between 0 and 1
      */
      let a = (inputIntensity/255);
      console.log("a: " + a);

      /*
        From the book we can use the formula: gamma = ln(input)/ln(a)
      */
      let gamma = (Math.log(inputIntensity))/(Math.log(a)); /* TODO Compute gamma from the input intensity. */
      console.log("Gamma: " + gamma);

      /*
        I wanted to keep it clean and only display two decimal places
      */
      document.getElementById("gamma").textContent = gamma.toFixed(2);

      /*
        Another QOL improvement to change the color of the displayed gamma
        depending on the current input intensity so that the text is able to be
        seen on any intensity
      */
      if (inputIntensity < 128) {
        document.getElementById("gamma").style.color = "white";
      } else {
        document.getElementById("gamma").style.color = "black";
      }
    }

    window.onload = render(128);
  </script>

</body></html>
